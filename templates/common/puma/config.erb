<%= comment_box "Puma configuration for #{app_name}" %>
<%= comment_box "Generated by Goico - Rails Application Packager" %>

# Server configuration
workers <%= workers %>
threads <%= threads.min %>, <%= threads.max %>

# Binding configuration
<% if bind.start_with?('unix://') %>
# Unix socket for reverse proxy setup
bind "<%= bind %>"
<% else %>
# TCP binding for standalone operation
bind "<%= bind %>"
<% end %>

# Process management
pidfile "<%= pidfile %>"
state_path "<%= run_path %>/puma.state"
directory "<%= app_install_path %>"

# Logging configuration
<%= comment_box "Logs are managed by the service manager" %>
stdout_redirect "<%= log_path %>/puma.stdout.log", "<%= log_path %>/puma.stderr.log", true
quiet false

# Environment
environment "production"

# Do not daemonize - let service manager handle process supervision
daemonize false

# Performance optimizations
preload_app!
prune_bundler

# Database connection management
on_worker_boot do
  ActiveRecord::Base.establish_connection if defined?(ActiveRecord)
end

before_fork do
  ActiveRecord::Base.connection_pool.disconnect! if defined?(ActiveRecord)
end

# Zero-downtime deployment support
on_restart do
  # Implement your application's restart logic here
end

# Plugin configuration
plugin :tmp_restart

<%= comment_box "End of Goico-generated Puma configuration" %>