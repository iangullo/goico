<%= comment_box "Backup Configuration for #{app_name}" %>
<%= comment_box "Generated by Goico - Rails Application Packager" %>

# Backup configuration
backup:
  app_name: <%= app_name %>
  version: 1.0.0
  generated_at: <%= Time.now.utc.iso8601 %>

# Database configuration
database:
  type: <%= @analysis[:database] %>
  host: localhost
  database: <%= app_name %>_production
  username: <%= @options[:db_user] || app_name %>

  <% case @analysis[:database] %>
  <% when :postgresql %>
  # PostgreSQL specific settings
  dump_command: "pg_dump"
  restore_command: "pg_restore"
  dump_options: "--verbose --clean --no-owner --no-acl --format=custom"
  <% when :mysql %>
  # MySQL specific settings
  dump_command: "mysqldump"
  restore_command: "mysql"
  dump_options: "--single-transaction --quick --lock-tables=false"
  <% when :sqlite %>
  # SQLite specific settings
  dump_command: "cp"
  restore_command: "cp"
  <% end %>

# Backup storage
storage:
  local:
    path: <%= @options[:backup_path] || "/var/backups/#{app_name}" %>
    keep: 30  # Number of backups to keep

  # Optional: Cloud storage (uncomment and configure as needed)
  # s3:
  #   access_key_id: <%= @options[:aws_access_key_id] %>
  #   secret_access_key: <%= @options[:aws_secret_access_key] %>
  #   bucket: <%= app_name %>-backups
  #   region: us-east-1
  #   path: backups/
  #   keep: 90

# What to backup
backup_items:
  database:
    enabled: true
    schedule: "0 2 * * *"  # Daily at 2 AM

  application:
    enabled: true
    paths:
      - <%= app_install_path %>/config
      - <%= app_install_path %>/vendor/bundle
      - <%= config_install_path %>
    exclude:
      - "*.log"
      - "tmp/cache"
      - "node_modules"
    schedule: "0 1 * * 0"  # Weekly on Sunday at 1 AM

  logs:
    enabled: false  # Usually not needed for backups
    path: <%= log_path %>

# Encryption (optional)
encryption:
  enabled: false
  # gpg_public_key: ""  # Set if you want encrypted backups

# Notifications
notifications:
  email:
    enabled: false
    # address: admin@example.com
    # on_success: true
    # on_failure: true
  slack:
    enabled: false
    # webhook_url: ""